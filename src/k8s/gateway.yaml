# GatewayClass (must be first)
apiVersion: gateway.networking.k8s.io/v1beta1
kind: GatewayClass
metadata:
  name: kong
  annotations:
    konghq.com/gatewayclass-unmanaged: 'true'
spec:
  controllerName: konghq.com/kic-gateway-controller

---
# Gateway (references GatewayClass)
apiVersion: gateway.networking.k8s.io/v1beta1
kind: Gateway
metadata:
  name: count-gateway
  namespace: count-system
spec:
  gatewayClassName: kong
  listeners:
    - name: proxy
      protocol: HTTP
      port: 80
      allowedRoutes:
        namespaces:
          from: All

---
# HTTPRoute for Count Item Management (API and UI)
apiVersion: gateway.networking.k8s.io/v1beta1
kind: HTTPRoute
metadata:
  name: count-management-route
  namespace: count-system
spec:
  parentRefs:
    - name: count-gateway
      namespace: count-system
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /api/v1/count-items
        - path:
            type: PathPrefix
            value: /ui
      backendRefs:
        - name: count-management-service
          port: 8080

---
# HTTPRoute for Count Processing (External Update API)
apiVersion: gateway.networking.k8s.io/v1beta1
kind: HTTPRoute
metadata:
  name: count-processing-route
  namespace: count-system
spec:
  parentRefs:
    - name: count-gateway
      namespace: count-system
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /api/v1/counts
      backendRefs:
        - name: count-processing-service
          port: 8080
